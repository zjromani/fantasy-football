{% extends "base.html" %}
{% block content %}
{% if league_settings and league_settings.get("scoring") %}
<div style="padding:0.75rem 1rem; background:#f1f5f9; border:1px solid #e2e8f0; border-radius:8px; margin-bottom:1rem;">
  <strong>League Settings detected:</strong>
  <span style="margin-left:0.5rem;">PPR: {{ league_settings["scoring"]["ppr"] }}</span>
  {% if league_settings.get("roster_positions") %}
  <span style="margin-left:0.5rem;">Slots: {{ league_settings["roster_positions"]|length }}</span>
  {% endif %}
  <form method="post" action="/actions/gm_brief" style="display:inline; margin-left:1rem;">
    <button class="btn">Post GM Brief</button>
  </form>
  <form method="post" action="/actions/waivers_demo" style="display:inline; margin-left:0.5rem;">
    <button class="btn">Post Waivers Demo</button>
  </form>
  <form method="post" action="/actions/ingest_now" style="display:inline; margin-left:0.5rem;">
    <button class="btn">Run Ingest Now</button>
  </form>
  <form method="post" action="/actions/waivers_live" style="display:inline; margin-left:0.5rem;">
    <button class="btn">Waivers (Live)</button>
  </form>
</div>
{% else %}
<div style="padding:0.75rem 1rem; background:#fff7ed; border:1px solid #fed7aa; border-radius:8px; margin-bottom:1rem;">
  <strong>No League Settings yet.</strong> Load via the OAuth scripts in the README or <a href="/oauth/start">Connect Yahoo</a>.
  <form method="post" action="/actions/gm_brief" style="display:inline; margin-left:1rem;">
    <button class="btn">Post GM Brief</button>
  </form>
  <form method="post" action="/actions/waivers_demo" style="display:inline; margin-left:0.5rem;">
    <button class="btn">Post Waivers Demo</button>
  </form>
  <form method="post" action="/actions/load_settings" style="display:inline; margin-left:0.5rem;">
    <button class="btn">Load Settings</button>
  </form>
</div>
{% endif %}
<div class="filters">
  <strong>Filter:</strong>
  <a href="/" {% if not filter_kind %}class="unread"{% endif %}>All</a>
  <a href="/?kind=lineup" {% if filter_kind=='lineup' %}class="unread"{% endif %}>Lineup</a>
  <a href="/?kind=waivers" {% if filter_kind=='waivers' %}class="unread"{% endif %}>Waivers</a>
  <a href="/?kind=trades" {% if filter_kind=='trades' %}class="unread"{% endif %}>Trades</a>
  <a href="/?kind=survivor" {% if filter_kind=='survivor' %}class="unread"{% endif %}>Survivor</a>
  <a href="/?kind=info" {% if filter_kind=='info' %}class="unread"{% endif %}>Info</a>
  <form method="post" action="/actions/notifications/mark_all_read" style="display:inline; margin-left:1rem;">
    <button class="btn">Mark all as read</button>
  </form>
  <hr>
</div>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Kind</th>
      <th>Created</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
  {% for n in notifications %}
    <tr class="{% if not n["is_read"] %}unread{% endif %}">
      <td><a href="/notifications/{{ n["id"] }}">{{ n["title"] }}</a></td>
      <td><span class="pill">{{ n["kind"] }}</span></td>
      <td>{{ n["created_at"] }}</td>
      <td>{% if n["is_read"] %}Read{% else %}Unread{% endif %}</td>
    </tr>
  {% else %}
    <tr><td colspan="4">No notifications.</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}


